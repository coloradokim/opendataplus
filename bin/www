#!/usr/bin/env node
var debug = require('debug')('odp');
var app = require('../app');
var fs = require('fs');
var https = require('https');

var port = process.env.PORT || 3000;

var options = {
  key: fs.readFileSync('config/server.key'),
  cert: fs.readFileSync('config/server.crt')
};

var dbAuthDone = false;
global.db.authenticate("odp", "Hack4art", function(error, result) {
  console.log("RESULT FROM DB authentication:", error, result)
  dbAuthDone = true;
});
while (!dbAuthDone) {
  require('deasync').runLoopOnce();
}

var server = https.createServer(options, app).listen(port);
debug('Express server listening on port ' + server.address().port);


